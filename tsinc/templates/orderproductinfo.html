
{% extends 'layout.html' %} {% block body %}{% load humanize %}


<div class="container">

  <div class="row mb-4">
       <div class="col-md-2 text-center">
        <div class="card">
          <div class="card-body d-flex flex-column">
            <span class="fs-6 fw-bold">Precio Total ({{badge}}): </span>
            <span class="fs-3 fw-light">{{total_info.t_price|intcomma}}</span>
          </div>
        </div>
      </div>
      <div class="col-md-2 text-center">
        <div class="card">
          <div class="card-body d-flex flex-column">
            <span class="fs-6 fw-bold">Entregado ({{badge}}): </span>
            <span class="fs-3 fw-light">{{total_info.d_price|intcomma}}</span>
          </div>
        </div>
      </div>
      <div class="col-md-2 text-center">
        <div class="card">
          <div class="card-body d-flex flex-column">

            {% if total_info.leftover != 0  %}
                <span class="fs-6 fw-bold">Restante ({{badge}}):</span>
                <span class="fs-3 fw-light bg-danger px-2 rounded text-light">{{total_info.r_price|intcomma}}</span>
                {% else %}

                <span class="fs-6 fw-bold">Restante ({{badge}}):</span>
                <span class="fs-3 fw-light bg-success px-2 rounded text-light">{{total_info.r_price|intcomma}}</span>

            {% endif %}

          </div>
        </div>
      </div>
      <div class="col-md-2 text-center">
        <div class="card">
          <div class="card-body d-flex flex-column">
            <span class="fs-6 fw-bold d-flex flex-column">Cantidad Total:</span>
            <span class="fs-3 fw-light">{{total_info.t_quantity}}</span>
          </div>
        </div>
      </div>
      <div class="col-md-2 text-center">
        <div class="card">
          <div class="card-body d-flex flex-column">
            <span class="fs-6 fw-bold">Entregado: </span>
            <span class="fs-3 fw-light">{{total_info.arrived}}</span>
          </div>
        </div>
      </div>
      <div class="col-md-2 text-center">
        <div class="card">
          <div class="card-body d-flex flex-column">
            {% if total_info.leftover != 0  %}
            <span class="fs-6 fw-bold">Restante:</span>
            <span class="fs-3 fw-light bg-danger px-2 rounded text-light">{{total_info.leftover}}</span>
            {% else %}
            <span class="fs-6 fw-bold">Restante:</span>
            <span class="fs-3 fw-light bg-success px-2 rounded text-light">{{total_info.leftover}}</span>
           {% endif %}
          </div>
        </div>
      </div>
        

     
  </div>

     <div class="row m-2">
      <div class="col-md-6">
  
        <span class="fs-4 fw-bolder">Tardo en entregar(todo): </span> 
        <span class="fs-3 fw-light">{{delivery_time}} días</span>
     
      </div>
      <div class="col-md-6">
  
     
  
      </div>
    </div> 
    <div class="row mb-4">

        <div class="col-md-4">
            <ul class="list-group">
               
                <li class="list-group-item"><strong>Fecha: </strong>{{order.date}}</li>
                <li class="list-group-item"><strong>OP Code: </strong>{{order.code}}</li>
                <li class="list-group-item"><strong>Tracking: </strong>{{order.tracking}}</li>
                <li class="list-group-item"><strong>Proveedor: </strong>{{order.supplier}}</li>
                <li class="list-group-item"><strong>NIT: </strong>{{order.nit}}</li>
                <li class="list-group-item"><strong>Dirección: </strong>{{order.address}}</li>
                <li class="list-group-item"><strong>Telefono: </strong>{{order.phone}}</li>
                <li class="list-group-item"><strong>Cliente: </strong>{{order.customer}}</li>
                <li class="list-group-item"><strong>Centro de Costo: </strong>{{order.cost_center}}</li>
                <li class="list-group-item"><strong>Interventor: </strong>{{order.inspector}}</li>
                <li class="list-group-item"><strong>Supervisor: </strong>{{order.supervisor}}</li>
                <li class="list-group-item"><strong>Observación: </strong>{{order.observation}}</li>
              </ul>

        </div>
   
       <div class="col-md-8">

        <a href="{% url 'create_order_entry' order.id %}"class="btn btn-primary mb-2" >Ver Entradas</a>
        <a href="{% url 'edit_order' order.id %}"class="btn btn-primary mb-2" >Editar Orden</a>

        <div class="accordion accordion-flush" id="accordionHVAC">
          {% for product in products %}
          
          
          <div class="accordion-item">
            <div class="accordion-header d-flex" id="flush-heading{{product.product.model}}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse{{product.product.model}}" aria-expanded="false" aria-controls="flush-collapse{{product.product.model}}">
                {% for info in info_per_product %}
                {% if product.id == info.id %}
                <div class="container">
                  <div class="row">
                    <div class="col">
                      <strong class="mx-2">Modelo:</strong>{{product.product.model}} 
                    </div>
      
                    <div class="col">
                      <strong class="mx-2">Cantidad:</strong>{{product.quantity}} 
                    </div>
                    <div class="col">
                      <strong class="mx-2">Precio(UND):</strong> {{product.price|intcomma}}
                    </div>
                    <div class="col">
                      <strong class="mx-2">Entregado:</strong> {{info.t_quantity}}
                    </div>
                    <div class="col">
                      <strong class="mx-2">Restantes:</strong> {{info.leftover}}
                    </div>
                  </div>
                </div>
                {% endif %}
                {% endfor %}
                
              </button>
          </div>
            <div id="flush-collapse{{product.product.model}}" class="accordion-collapse collapse" aria-labelledby="flush-heading{{product.product.model}}" data-bs-parent="#accordionHVAC">
              <div class="accordion-body p-0">
                  <ul class="list-group">
                  {% for entry in orderentry %}
                  {% if product.id == entry.product.id %}
                  
                      <li class="list-group-item d-flex justify-content-between ">
                          <span>Entrada: {{entry.date|naturaltime}}</span>
                          <span>Producto: {{entry.product.product.model}}</span>
                          <span>Cantidad entregada: {{entry.quantity}}</span>
                            <a href="{% url 'entry_info' entry.id %}" class="btn btn-primary btn-sm" data-bs-toggle="tooltip" data-bs-placement="top" title="Ver detalles de entrada"> <i class="bi bi-box-arrow-right"></i></a>
                           

                          </span>

                          
                      </li>
                  

                {% endif %}
                {% endfor %}
              </ul>
              </div>
            </div>
          </div>
         
         
        {% endfor %}
        </div>
      
       </div>

      
    </div>
    <div class="row">
      <div class="col-md-4">

        <div class="card">
          <div class="card-header fw-bold">
            ARCHIVOS RELACIONADOS
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover table-light">
            <thead>
              
          
              <tr>

                <th scope="col">Nombre</th>
                <th scope="col">Tiempo de carga</th>
                <th ></th>
              </tr>
            
            </thead>
            <tbody>
              <tr>
                {% for file in orderfiles %}
    

                <td>{{file.name}}</td>
                <th>{{file.date|naturaltime}}</th>
                 <th>
                  <a href="{% url 'view_file' file.id 'oc' %}" class="btn btn-primary btn-sm"><i class="bi bi-eye"></i></a>
                  <a class="btn btn-danger btn-sm" href="{% url 'delete_order_file' file.id %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Borrar la remisión" onclick="return confirm_delete_remission()"> <i class="bi bi-trash"></i> </a>

                 </th>
              </tr>
              {%endfor%}
            </tbody>
          </table>
        </div>

      </div>
      <div class="col-md-6"></div>
  
    </div>
  </div>

{% endblock %}